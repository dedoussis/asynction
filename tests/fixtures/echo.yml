channels:
  /:
    publish:
      message:
        oneOf:
          - $ref: '#/components/messages/EchoCommand'
    subscribe:
      message:
        oneOf:
          - $ref: '#/components/messages/EchoResponse'
  /admin:
    publish:
      message:
        oneOf:
          - $ref: '#/components/messages/EchoCommand'
    subscribe:
      message:
        oneOf:
          - $ref: '#/components/messages/EchoResponse'
    x-handlers:
      connect: tests.fixtures.handlers.authenticated_connect
    bindings:
      ws:
        query:
          type: object
          properties:
            token:
              type: string
          required: [token]
  /echo_with_error_feedback:
    publish:
      message:
        oneOf:
          - $ref: '#/components/messages/EchoCommand'
    subscribe:
      message:
        oneOf:
          - $ref: '#/components/messages/EchoResponse'
          - $ref: '#/components/messages/EchoErrors'
    x-handlers:
      error: tests.fixtures.handlers.echo_failed_validation
components:
  messages:
    EchoCommand:
      name: echo
      x-handler: tests.fixtures.handlers.echo
      payload:
        type: string
    EchoResponse:
      name: echo
      payload:
        type: string
    EchoErrors:
      name: echo errors
      payload:
        type: string